<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investments - Heritage Bank</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .container {
            max-width: 900px;
            margin: 50px auto;
            padding: 30px;
        }
        h1 {
            color: #1a472a;
            text-align: center;
            margin-bottom: 30px;
        }
        .back-link {
            color: #d4af37;
            text-decoration: none;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 20px;
            display: inline-block;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .investment-item {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr auto;
            gap: 20px;
            align-items: center;
            padding: 20px;
            background: #f5f7fa;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .investment-info h3 {
            color: #1a472a;
            margin: 0 0 5px 0;
        }
        .investment-info p {
            color: #999;
            margin: 0;
            font-size: 12px;
        }
        .investment-return {
            font-size: 20px;
            font-weight: bold;
            color: #d4af37;
        }
        .invest-btn {
            padding: 10px 20px;
            background: #d4af37;
            color: #1a472a;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .invest-btn:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }
        .form-group label {
            margin-bottom: 8px;
            color: #1a472a;
            font-weight: 600;
        }
        .form-group input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }
        .form-group input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <a class="back-link" onclick="window.location.href = '/dashboard.html'">← Back to Dashboard</a>
        
        <h1><i class="fas fa-chart-line"></i> Investments</h1>

        <div class="card">
            <h2 style="color: #1a472a; margin-top: 0;">Available Investment Products</h2>
            
            <div class="investment-item">
                <div class="investment-info">
                    <h3>Savings Bond</h3>
                    <p>Low risk, guaranteed returns</p>
                </div>
                <div>
                    <p style="margin: 0; color: #1a472a;">Min: $500</p>
                    <p style="margin: 0; color: #999; font-size: 12px;">1-5 year terms</p>
                </div>
                <div class="investment-return">3.5% APY</div>
                <button class="invest-btn" onclick="investNow('Savings Bond', 3.5)">Invest</button>
            </div>

            <div class="investment-item">
                <div class="investment-info">
                    <h3>Index Fund</h3>
                    <p>Moderate risk, diversified portfolio</p>
                </div>
                <div>
                    <p style="margin: 0; color: #1a472a;">Min: $1,000</p>
                    <p style="margin: 0; color: #999; font-size: 12px;">5+ year horizon</p>
                </div>
                <div class="investment-return">7.2% APY*</div>
                <button class="invest-btn" onclick="investNow('Index Fund', 7.2)">Invest</button>
            </div>

            <div class="investment-item">
                <div class="investment-info">
                    <h3>Fixed Deposit</h3>
                    <p>Flexible terms, competitive rates</p>
                </div>
                <div>
                    <p style="margin: 0; color: #1a472a;">Min: $1,000</p>
                    <p style="margin: 0; color: #999; font-size: 12px;">3-12 month terms</p>
                </div>
                <div class="investment-return">4.8% APY</div>
                <button class="invest-btn" onclick="investNow('Fixed Deposit', 4.8)">Invest</button>
            </div>

            <div class="investment-item">
                <div class="investment-info">
                    <h3>Growth Fund</h3>
                    <p>Higher risk, long-term growth potential</p>
                </div>
                <div>
                    <p style="margin: 0; color: #1a472a;">Min: $2,000</p>
                    <p style="margin: 0; color: #999; font-size: 12px;">10+ year horizon</p>
                </div>
                <div class="investment-return">9.5% APY*</div>
                <button class="invest-btn" onclick="investNow('Growth Fund', 9.5)">Invest</button>
            </div>
        </div>

        <div class="card">
            <h2 style="color: #1a472a; margin-top: 0;">Make an Investment</h2>
            
            <form onsubmit="handleInvestment(event)">
                <div class="form-group">
                    <label>Investment Product</label>
                    <select id="product" style="padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;" required>
                        <option value="">Select a product...</option>
                        <option value="Savings Bond">Savings Bond (3.5% APY)</option>
                        <option value="Index Fund">Index Fund (7.2% APY)</option>
                        <option value="Fixed Deposit">Fixed Deposit (4.8% APY)</option>
                        <option value="Growth Fund">Growth Fund (9.5% APY)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Investment Amount (USD)</label>
                    <input type="number" id="investAmount" placeholder="1000" min="500" step="100" required>
                </div>

                <div class="form-group">
                    <label>Investment Period (Years)</label>
                    <input type="number" id="period" placeholder="5" min="1" max="30" step="1" required>
                </div>

                <button type="submit" style="padding: 12px; background: #d4af37; color: #1a472a; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.3s; width: 100%;">
                    <i class="fas fa-check"></i> Invest Now
                </button>
            </form>
        </div>

        <p style="color: #999; font-size: 12px; text-align: center; margin-top: 20px;">
            * Past performance does not guarantee future results. Please read all investment documents carefully.
        </p>
    </div>

    <script src="script.js"></script>
    <script>
        const API_URL = 'http://localhost:3001';
        let userId = null;
        const token = localStorage.getItem('token');

        if (!token) {
            window.location.href = 'signin.html';
        }

        // Get user info on load
        async function checkAuth() {
            try {
                const res = await fetch(`${API_URL}/api/auth/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (res.ok) {
                    const data = await res.json();
                    userId = data.user.id;
                } else {
                    window.location.href = 'signin.html';
                }
            } catch (err) {
                console.error('Auth check failed:', err);
                window.location.href = 'signin.html';
            }
        }

        async function investNow(product, rate) {
            if (!userId) {
                alert('Please sign in to invest.');
                window.location.href = 'signin.html';
                return;
            }
            
            const amount = prompt(`Invest in ${product} (${rate}% APY)\n\nMinimum amount: $500\nEnter investment amount:`, '1000');
            
            if (amount && parseFloat(amount) >= 500) {
                const amountNum = parseFloat(amount);
                const payload = {
                    userId: userId,
                    product: `${product} (${rate}% APY)`,
                    amount: amountNum,
                    period: 5
                };

                try {
                    const res = await fetch(`${API_URL}/api/investments/invest`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify(payload)
                    });

                    const data = await res.json();
                    
                    if (data.success) {
                        showNotification(`✓ Investment of $${amountNum.toFixed(2)} in ${product} confirmed! Est. Return: $${data.investment.estimatedReturn}`, 'success');
                        setTimeout(() => {
                            window.location.href = 'dashboard.html';
                        }, 2000);
                    } else {
                        showNotification('Error: ' + data.message, 'error');
                    }
                } catch (err) {
                    showNotification('Error: ' + err.message, 'error');
                }
            } else if (amount) {
                showNotification('Minimum investment amount is $500', 'error');
            }
        }

        async function handleInvestment(e) {
            e.preventDefault();

            if (!userId) {
                alert('Please sign in to invest.');
                window.location.href = 'signin.html';
                return;
            }

            const product = document.getElementById('product').value;
            const amount = parseFloat(document.getElementById('investAmount').value);
            const period = parseInt(document.getElementById('period').value);

            if (!product || !amount || !period) {
                showNotification('Please fill all fields', 'error');
                return;
            }

            if (amount < 500) {
                showNotification('Minimum investment amount is $500', 'error');
                return;
            }

            const payload = {
                userId: userId,
                product: product,
                amount: amount,
                period: period
            };

            try {
                const res = await fetch(`${API_URL}/api/investments/invest`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (data.success) {
                    const { estimatedReturn, maturityDate } = data.investment;
                    const confirmMsg = `
Investment Confirmation
========================
Product: ${product}
Amount: $${amount.toFixed(2)}
Period: ${period} years
Est. Returns: $${estimatedReturn}
Maturity Date: ${new Date(maturityDate).toLocaleDateString()}

Your investment has been confirmed!
Funds have been invested immediately.
`;
                    alert(confirmMsg);
                    showNotification('✓ Investment confirmed!', 'success');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                } else {
                    showNotification('Error: ' + data.message, 'error');
                }
            } catch (err) {
                showNotification('Error: ' + err.message, 'error');
            }
        }

        // Initialize
        checkAuth();
    </script>
</body>
</html>
